@page "/Images"
@using Contracts
@using System.Net.Http.Headers
<br/>
<br/><br/>v<br/><br/><br/><br/>


<h3>AddingPost</h3>
<InputFile OnChange="@OnInputFileChange" />

<p>Fuckk</p>

@code {


    private async Task OnInputFileChange(InputFileChangeEventArgs e)
    {
        IBrowserFile file = e.File;
        await AddImage(file);
    }

    public async Task<string> AddImage(IBrowserFile browserFile)
    {
        using (var httpClient = new HttpClient())
        {
            using (var form = new MultipartFormDataContent())
            {
                using (var fs = browserFile.OpenReadStream())
                {
                    using (var streamContent = new StreamContent(fs))
                    {
                        using (var fileContent = new ByteArrayContent(await streamContent.ReadAsByteArrayAsync()))
                        {
                            fileContent.Headers.ContentType = MediaTypeHeaderValue.Parse("multipart/form-data");

    // "file" parameter name should be the same as the server side input parameter name
                            form.Add(fileContent, "file", browserFile.Name);
                            Uri uri = new Uri($"http://localhost:8080/uploadImage");
                            httpClient.DefaultRequestHeaders.Add("Authentification", "abc123");
                            HttpResponseMessage response = await httpClient.PostAsync(uri, form);
    
                            Console.Write("aaa");
                        }
                    }
                }
            }
        }
        Console.Write("done");
        return "done";
    }

}